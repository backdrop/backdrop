#
# Apache VirtualHost configuration used by Travis CI.
#
# This configuration file will be placed into the default Apache configuration
# on test machines, making it so that the localhost URL will be able to serve
# pages generated by PHP-FPM.
#
<VirtualHost *:8080>
  ServerAdmin webmaster@localhost
  DocumentRoot ${TRAVIS_BUILD_DIR}

  <Directory />
    Options FollowSymLinks
    AllowOverride None
  </Directory>

  # This directory will be replaced with the appropriate web root by the
  # .travis.yml configuration.
  <Directory "${TRAVIS_BUILD_DIR}">
    Options Indexes FollowSymLinks MultiViews ExecCGI
    AllowOverride All
    Order allow,deny
    Allow from all

    # Populate $_SERVER['BACKDROP_SETTINGS']. See backdrop_settings_initialize()
    # and the test in bootstrap.test.
    SetEnv BACKDROP_SETTINGS {"databases":{"test_database":{"default":{"driver":"mysql","database":"test_database","username":"test_username","password":"test_password","host":"test_host"}}},"settings":{"test_setting":"foo"}}
  </Directory>

  # Wire up Apache to use Travis CI's php-fpm.
  <IfModule mod_fastcgi.c>
    AddHandler php5-fcgi .php
    Action php5-fcgi /php5-fcgi
    Alias /php5-fcgi /usr/lib/cgi-bin/php5-fcgi
    FastCgiExternalServer /usr/lib/cgi-bin/php5-fcgi -idle-timeout 120 -host 127.0.0.1:9000 -pass-header Authorization
  </IfModule>
</VirtualHost>
